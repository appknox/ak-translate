<template>
  <router-link
    v-bind:to="'/vulnerabilities/' + vulnerability.id + '/translate'"
    v-bind:class="{ dirty: isDirty, active: isActive }"
    class="sidenav"
  >
    <div class="sidenav__key">
      <div class="sidenav__id">{{ paddedNumber(vulnerability.id, 3) }}</div>
      <div class="sidenav__name">{{ vulnerability.name }}</div>
    </div>
    <div
      class="sidenav__platform"
      v-bind:class="'sidenav__platform--' + vulnerability.platform"
    >
      <PlatformIcon
        v-bind:platform="vulnerability.platform"
        height="18px"
        width="18px"
      />
    </div>
  </router-link>
</template>

<script lang="ts">
import { Component, Prop, Watch, Vue } from "vue-property-decorator";
import VulnerabilityType from "../types/VulnerabilityType";
import PlatformIcon from "@/components/PlatformIcon.vue";

@Component({
  components: {
    PlatformIcon
  }
})
export default class SidebarVulnerability extends Vue {
  @Prop() private vulnerability!: VulnerabilityType;
  @Prop() private isActive!: boolean;
  @Prop() private targetLanguage!: string;

  private isDirty = false;

  @Watch("$store.state.modifiedVulnerabilitiesCounter")
  private watchModifiedVulnerabilities() {
    if (parseInt(this.$route.params.id) === this.vulnerability.id) {
      this.getIsDirty();
    }
  }

  getIsDirty() {
    if (!this.vulnerability) {
      this.isDirty = false;
    }
    this.isDirty = !!this.$store.getters.getModifiedVulnerability(
      this.vulnerability.id,
      this.targetLanguage
    );
  }

  paddedNumber(n: number, m: 3) {
    if (n < 10) {
      return `${"0".repeat(m - 1)}${n}`;
    }
    if (n < 100) {
      return `${"0".repeat(m - 2)}${n}`;
    }
    return `${n}`;
  }

  mounted() {
    this.getIsDirty();
  }
}
</script>

<style scoped lang="scss">
$sidebar-padding: 1rem;

.sidenav {
  padding: 0.5rem $sidebar-padding - 0.2rem 0.5rem $sidebar-padding;
  font-size: 0.84rem;
  line-height: 1.4;
  display: flex;
  align-items: stretch;
  color: $sidebar-color;
  border-right: 2px solid transparent;
  &:hover,
  &:focus {
    color: $color-primary;
  }
  &__key {
    display: flex;
    align-items: flex-start;
  }
  &__name {
    padding-left: 0.5rem;
  }
  &__platform {
    margin-left: auto;
    display: flex;
    align-items: center;
  }
  &.active {
    // border-color: $sidebar-active-border-color;
    color: $sidebar-active-color;
    background: $sidebar-active-bg;
  }
  &.dirty {
    border-right-color: $color-dirty;
  }
}
</style>

<style lang="scss">
.sidenav {
  &__platform {
    svg path {
      fill: $sidebar-platform-icon-color;
    }
  }
  &.active,
  &:hover {
    .sidenav__platform {
      &--android svg path {
        fill: $sidebar-android-icon-color;
      }
      &--ios svg path {
        fill: $sidebar-ios-icon-color;
      }
      &--api svg path {
        fill: $sidebar-api-icon-color;
      }
      &--common svg path {
        fill: $sidebar-common-icon-color;
      }
    }
  }
}
</style>
