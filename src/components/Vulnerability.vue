<template>
  <div class="contain-height">
    <div v-if="enVulnerability" class="vuln--read">
      <div class="vuln__row">
        <section class="vuln__col">
          <div class="vuln__lang">
            <LanguageDisplay v-bind:language="'en'" />
          </div>
        </section>
        <section class="vuln__col">
          <div class="vuln__lang">
            <LanguageDisplay v-bind:language="language" />
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.name.updatedOn)"
            v-bind:class="{
              updated: hasUpdates('name', enVulnerability, langVulnerability)
            }"
          >
            Title
          </div>
          <div class="vuln__name">
            <v-md-editor
              v-model="enVulnerability.name.content"
              mode="preview"
            ></v-md-editor>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.name.updatedOn)"
            >
              Title
            </div>
            <div class="vuln__name">
              <v-md-editor
                v-model="langVulnerability.name.content"
                mode="preview"
              ></v-md-editor>
            </div>
          </div>
          <div v-else class="vuln__section__heading">Not found!</div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.question.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'question',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Question
          </div>
          <div class="vuln__question">
            <v-md-editor
              v-model="enVulnerability.question.content"
              mode="preview"
            ></v-md-editor>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.question.updatedOn)"
            >
              Question
            </div>
            <div class="vuln__question">
              <v-md-editor
                v-model="langVulnerability.question.content"
                mode="preview"
              ></v-md-editor>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.summary.updatedOn)"
            v-bind:class="{
              updated: hasUpdates('summary', enVulnerability, langVulnerability)
            }"
          >
            Summary
          </div>
          <div class="vuln__summary">
            <v-md-editor
              v-model="enVulnerability.summary.content"
              mode="preview"
            ></v-md-editor>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.summary.updatedOn)"
            >
              Summary
            </div>
            <div class="vuln__summary">
              <v-md-editor
                v-model="langVulnerability.summary.content"
                mode="preview"
              ></v-md-editor>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.description.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'description',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Description
          </div>
          <div class="vuln__desc">
            <v-md-editor
              v-model="enVulnerability.description.content"
              mode="preview"
            ></v-md-editor>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.description.updatedOn)"
            >
              Description
            </div>
            <div class="vuln__desc">
              <v-md-editor
                v-model="langVulnerability.description.content"
                mode="preview"
              ></v-md-editor>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="
              getTitle(enVulnerability.businessImplication.updatedOn)
            "
            v-bind:class="{
              updated: hasUpdates(
                'businessImplication',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Business Implication
          </div>
          <div class="vuln__business-implication">
            <v-md-editor
              v-if="enVulnerability.businessImplication"
              v-model="enVulnerability.businessImplication.content"
              mode="preview"
            ></v-md-editor>
            <div v-else>_</div>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="
                getTitle(langVulnerability.businessImplication.updatedOn)
              "
            >
              Business Implication
            </div>
            <div class="vuln__business-implication">
              <v-md-editor
                v-if="langVulnerability.businessImplication"
                v-model="langVulnerability.businessImplication.content"
                mode="preview"
              ></v-md-editor>
              <div v-else>_</div>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.compliant.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'compliant',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Compliant
          </div>
          <div class="vuln__compliant">
            <v-md-editor
              v-if="enVulnerability.compliant"
              v-model="enVulnerability.compliant.content"
              mode="preview"
            ></v-md-editor>
            <div v-else>_</div>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.compliant.updatedOn)"
            >
              Compliant
            </div>
            <div class="vuln__compliant">
              <v-md-editor
                v-if="langVulnerability.compliant"
                v-model="langVulnerability.compliant.content"
                mode="preview"
              ></v-md-editor>
              <div v-else>_</div>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.nonCompliant.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'nonCompliant',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Non Compliant
          </div>
          <div class="vuln__non-compliant">
            <v-md-editor
              v-if="enVulnerability.nonCompliant"
              v-model="enVulnerability.nonCompliant.content"
              mode="preview"
            ></v-md-editor>
            <div v-else>_</div>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.nonCompliant.updatedOn)"
            >
              Non Compliant
            </div>
            <div class="vuln__non-compliant">
              <v-md-editor
                v-if="langVulnerability.nonCompliant"
                v-model="langVulnerability.nonCompliant.content"
                mode="preview"
              ></v-md-editor>
              <div v-else>_</div>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.successMessage.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'successMessage',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Success Message
          </div>
          <div class="vuln__success-message">
            <v-md-editor
              v-model="enVulnerability.successMessage.content"
              mode="preview"
            ></v-md-editor>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="
                getTitle(langVulnerability.successMessage.updatedOn)
              "
            >
              Success Message
            </div>
            <div class="vuln__success-message">
              <v-md-editor
                v-model="langVulnerability.successMessage.content"
                mode="preview"
              ></v-md-editor>
            </div>
          </div>
        </section>
      </div>

      <div class="vuln__row">
        <section class="vuln__col vuln__section">
          <div
            class="vuln__section__heading"
            v-bind:title="getTitle(enVulnerability.relatedTo.updatedOn)"
            v-bind:class="{
              updated: hasUpdates(
                'relatedTo',
                enVulnerability,
                langVulnerability
              )
            }"
          >
            Related To
          </div>
          <div class="vuln__related-to">
            <v-md-editor
              v-if="enVulnerability.relatedTo"
              v-model="enVulnerability.relatedTo.content"
              mode="preview"
            ></v-md-editor>
            <div v-else>_</div>
          </div>
        </section>
        <section class="vuln__col vuln__section">
          <div v-if="langVulnerability">
            <div
              class="vuln__section__heading"
              v-bind:title="getTitle(langVulnerability.relatedTo.updatedOn)"
            >
              Related To
            </div>
            <div class="vuln__related-to">
              <v-md-editor
                v-if="langVulnerability.relatedTo"
                v-model="langVulnerability.relatedTo.content"
                mode="preview"
              ></v-md-editor>
              <div v-else>_</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { Component, Prop, Vue } from "vue-property-decorator";
import dayjs from "dayjs";
import languageIcon from "@/shared/languageIcon";
import VulnerabilityType from "@/types/VulnerabilityType";
import LanguageDisplay from "@/components/LanguageDisplay.vue";

@Component({
  components: {
    LanguageDisplay
  }
})
export default class Vulnerability extends Vue {
  @Prop() private enVulnerability!: VulnerabilityType;
  @Prop() private langVulnerability!: VulnerabilityType;
  @Prop() private language!: string;

  private languageIcon = languageIcon;

  hasUpdates(field, enVulnerability, langVulnerability) {
    if (
      (enVulnerability && !enVulnerability[field].updatedOn) ||
      (langVulnerability && !langVulnerability[field].updatedOn)
    ) {
      return false;
    }
    if (!langVulnerability) {
      return true;
    }
    if (
      new Date(enVulnerability[field].updatedOn) >
      new Date(langVulnerability[field].updatedOn)
    ) {
      return true;
    }
    return false;
  }

  getTitle(updatedOn = "") {
    if (!updatedOn) {
      return "";
    }
    return `Updated on ${dayjs(updatedOn).format("MMMM D, YYYY h:mm A")}`;
  }
}
</script>

<style scoped lang="scss">
$padding-h: 2rem;
.vuln {
  &--read {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: stretch;
    background: $vulnerability-split-bg;
  }
  &__row {
    display: flex;
  }
  &__col {
    flex: 1;
    width: 50%;
    padding-left: $padding-h;
    padding-right: $padding-h;
    word-break: break-all;
    white-space: normal;
  }
  &__section {
    margin-bottom: 2.5rem;
    &__heading {
      display: flex;
      align-items: center;
      padding-bottom: 0.5rem;
      text-transform: uppercase;
      font-size: 0.8rem;
      color: #a5a5a5;
      &.updated::after {
        content: "new changes";
        background: $color-waiting;
        color: white;
        margin-left: 0.5rem;
        padding: 0.01rem 0.3rem 0.015rem;
        border-radius: 0.1rem;
        text-transform: uppercase;
        font-size: 0.57rem;
        font-weight: 600;
      }
    }
  }
  &__lang {
    text-align: center;
    padding: 1.5rem;
  }
}
</style>
