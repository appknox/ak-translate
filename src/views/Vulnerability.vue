<template>
  <div class="vulnerability contain-height">
    <NavBar class="sitenav" v-bind:breadcrumb="breadcrumb" />
    <div class="side-panel-layout">
      <aside class="sidebar">
        <nav class="vulnerability-nav">
          <ul>
            <li v-for="v in vulnerabilities" :key="v.key" class="vuln-nav">
              <router-link v-bind:to="'/vulnerability/' + v.id">
                <div class="vuln-nav__id">{{ v.id }}</div>
                <div class="vuln-nav__name">{{ v.name }}</div></router-link
              >
            </li>
          </ul>
        </nav>
      </aside>
      <main class="main">
        <div>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed mi mi,
          aliquam dignissim ultricies eu, rhoncus quis nisl. Mauris sem mauris,
          suscipit sit amet sodales eu, mattis eu ante. Aliquam imperdiet
          dignissim magna, eu congue ipsum consequat pulvinar. Nam eu mauris a
          nulla facilisis tristique eu quis orci. Praesent nec mauris vitae
          felis sagittis bibendum. Vivamus et sapien purus. Etiam at hendrerit
          sapien. Sed neque tellus, venenatis id bibendum non, posuere quis
          diam. Phasellus hendrerit sapien id molestie tristique. Mauris id
          aliquam turpis, sodales malesuada tellus. Sed vel massa nisi. Donec eu
          interdum est. Praesent luctus nisi eget justo eleifend pulvinar.
          Aenean eleifend orci ipsum, at aliquet mauris pharetra in. Mauris
          commodo dapibus orci eget sollicitudin. Praesent a turpis vehicula,
          sodales urna id, tristique enim. Etiam venenatis placerat dolor eu
          consectetur. Proin fermentum, libero ut volutpat posuere, mi urna
          imperdiet lectus, eget pharetra odio nisi vel nulla. Cras ut lectus
          nec risus imperdiet suscipit et vitae neque. Praesent at velit ut elit
          viverra mollis. Curabitur aliquam lectus dui, vitae malesuada dolor
          pharetra sit amet. Nullam lacus dui, accumsan vitae neque vitae,
          auctor mollis sem. Cras dolor urna, ultrices eget laoreet quis,
          sollicitudin sit amet felis.
        </div>
        <router-view />
      </main>
    </div>
  </div>
</template>

<script lang="ts">
import { Options, Vue } from "vue-class-component";
import NavBar from "@/components/NavBar.vue";
import RepoContentService from "../services/RepoContentService";

interface GithubRepoContentResponse {
  type: string;
  name: string;
  path: string;
  content: string;
  download_url: string;
}

interface VulnerabilityType {
  id: number;
  key: string;
  name: string;
  platform: string;
}

@Options({
  components: {
    NavBar
  }
})
export default class Vulnerability extends Vue {
  private breadcrumb = [
    {
      label: "Projects",
      route: "/projects"
    },
    {
      label: "Vulnerabilities",
      route: null
    }
  ];

  private vulnerabilities: Array<VulnerabilityType> = [];

  getVulnerabilities() {
    RepoContentService.get("vulnerabilities").then(response => {
      const tree: GithubRepoContentResponse[] = response.data;
      this.vulnerabilities = tree
        .map(content => {
          const [id, platform, ...rest] = content.name.split("_");
          return {
            id: parseInt(id),
            key: content.name,
            name: rest.join(" "),
            platform: platform
          };
        })
        .sort((a, b) => (a.id > b.id ? 1 : -1));
    });
  }

  mounted() {
    this.getVulnerabilities();
  }
}
</script>

<style scoped lang="scss">
.sitenav {
  margin-bottom: -$navbar-height;
}
.side-panel-layout {
  height: 100%;
  padding-top: $navbar-height;
  display: flex;
  overflow: hidden;
}
.sidebar {
  overflow-y: scroll;
  background: lighten($color-text, 70%);
  width: 100%;

  @media (min-width: 768px) {
    width: 20rem;
  }
}
.main {
  overflow-y: scroll;
  width: 100%;
  flex: 1;
}

.vulnerability-nav {
  ul {
    padding: 0.3em 0;
  }
  li {
    &:not(:last-child) {
      border-bottom: 1px solid lighten($color-text, 60%);
    }
  }
}

.vuln-nav {
  a {
    padding: 0.3em;
    display: flex;
    align-items: stretch;
    color: $color-gray;
  }
  &__id {
    color: $color-text;
    width: 2em;
    text-align: right;
  }
  &__name {
    padding-left: 0.5em;
    text-align: left;
  }
}
</style>
